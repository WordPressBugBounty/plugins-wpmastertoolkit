!function(){"use strict";document.addEventListener("DOMContentLoaded",(()=>(()=>{const e=(e,i,o)=>{let s=e.target.closest("#menu-item-wpmastertoolkit-paste-image-in-media"),l=e.target.closest(".media-menu-item"),m=o.querySelector(".wpmastertoolkit-paste-image-in-media-tab");if(s){if(s.classList.contains("active"))return;let e=n();o.insertAdjacentHTML("beforeend",e),o.addEventListener("click",(e=>t(e))),o.setAttribute("aria-labelledby","menu-item-wpmastertoolkit-paste-image-in-media")}if(l){if(l.classList.contains("active"))return;a(l,i),m&&m.remove()}},t=e=>{let t=e.target.closest(".wpmastertoolkit-paste-image-in-media-tab__paste");t&&t.classList.add("focus")},a=(e,t)=>{t.querySelectorAll("button.media-menu-item").forEach((e=>{e.classList.remove("active"),e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1")})),e.classList.add("active"),e.setAttribute("aria-selected",!0),e.removeAttribute("tabindex")},i=()=>{let e=WPMastertoolkit_paste_image_in_media.tmpl_button_media_paste,t=["{{button_text}}"],a=[WPMastertoolkit_paste_image_in_media.i10n.button_text];for(let i=0;i<t.length;i++){const n=new RegExp(t[i],"g");e=e.replace(n,a[i])}return e},n=()=>{let e=WPMastertoolkit_paste_image_in_media.tmpl_tab_media_paste,t=["{{click_paste}}"],a=[WPMastertoolkit_paste_image_in_media.i10n.click_paste];for(let i=0;i<t.length;i++){const n=new RegExp(t[i],"g");e=e.replace(n,a[i])}return e};window.addEventListener("click",(e=>(e=>{if(!e.target.closest(".wpmastertoolkit-paste-image-in-media-tab__paste")){let e=document.querySelector(".media-modal .media-modal-content .media-frame-content .wpmastertoolkit-paste-image-in-media-tab__paste");e&&e.classList.remove("focus")}})(e))),wp.media.view.Modal.prototype.on("open",(()=>(()=>{let t=document.querySelectorAll(".media-modal .media-modal-content .media-frame-router .media-router"),a=document.querySelectorAll(".media-modal .media-modal-content .media-frame-content");if(0!=t.length&&0!=a.length)for(let n=0;n<t.length;n++){const o=t[n],s=a[n];if(s&&!o.querySelector("#menu-item-wpmastertoolkit-paste-image-in-media")){let t=i();o.insertAdjacentHTML("beforeend",t),o.addEventListener("click",(t=>e(t,o,s)))}}})())),wp.media.view.MediaFrame.Post.prototype.events.paste=e=>(e=>{let t=e.target.tagName;if(["INPUT","TEXTAREA"].includes(t)&&!e.target.classList.contains("wpmastertoolkit-paste-image-in-media-tab__paste__input"))return;let a=e.originalEvent.clipboardData.items,i=null;for(let e=0;e<a.length;e++)0===a[e].type.indexOf("image")&&(i=a[e].getAsFile());if(null===i)return;let n=prompt(WPMastertoolkit_paste_image_in_media.i10n.prompt_text);if(null!==n){n=""===n?"image":n,i=new File([i],`${n}.png`,{type:"image/png",lastModified:Date.now()});var o=new FormData;o.append("async-upload",i),o.append("name",i.name),o.append("action","upload-attachment"),o.append("_wpnonce",WPMastertoolkit_paste_image_in_media.nonce),fetch("/wp-admin/async-upload.php",{method:"POST",body:o,redirect:"follow"}).then((e=>e.json())).then((e=>{if(e.success){let t=e.data.id;wp.media.frame.content.get().collection?wp.media.frame.content.get().collection.props.set({ignore:+new Date}):wp.media.frame.library.props.set({ignore:+new Date}),WPMastertoolkit_paste_image_in_media.is_upload_page||wp.media.frame.state().get("selection").add(wp.media.attachment(t))}})).catch((e=>{console.log("ERROR: ",e)}))}})(e)})()))}();